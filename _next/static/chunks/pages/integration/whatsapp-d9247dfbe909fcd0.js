(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4987],{7492:(e,t,s)=>{"use strict";s.d(t,{$:()=>i});var a=s(37876);s(14232);var n=s(69241),r=s(95313);let o={default:"bg-gray-500 hover:bg-gray-600 text-white",primary:"bgMediumBlue hover:bgHardBlue text-white",danger:"bg-red-600 hover:bg-red-700 text-white"},i=e=>{let{variant:t="default",loading:s=!1,children:i,className:l,loaderIcon:c,...d}=e;return(0,a.jsx)("button",{className:(0,n.A)("font-medium text-base px-4 py-2 rounded transition cursor-pointer flex items-center justify-center gap-2",o[t],l),disabled:s||d.disabled,...d,children:s?c||(0,a.jsx)(r.A,{className:"h-4 w-4 animate-spin"}):i})}},31146:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(37876),n=s(65259),r=s(43598),o=s(14e3),i=s(14232),l=s(75683),c=s(7492);let d=()=>{window.fbAsyncInit=function(){FB.init({appId:"590587726705485",autoLogAppEvents:!0,xfbml:!0,version:"v21.0"})},function(e,t,s){var a,n=e.getElementsByTagName(t)[0];e.getElementById(s)||((a=e.createElement(t)).id=s,a.src="https://connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(a,n))}(document,"script","facebook-jssdk")},h=()=>{!window.__sonic_setup_done&&(window.__sonic_setup_done=!0,window.addEventListener("message",e=>{if("https://www.facebook.com"===e.origin||"https://web.facebook.com"===e.origin)try{let t=JSON.parse(e.data);if("WA_EMBEDDED_SIGNUP"===t.type){if("FINISH"===t.event)p(t.data);else if("CANCEL"===t.event){let{current_step:e}=t.data;console.warn("Cancel at ",e)}else if("ERROR"===t.event){let{error_message:e}=t.data;console.error("error ",e)}}document.getElementById("session-info-response").textContent=JSON.stringify(t,null,2)}catch(t){console.log("Non JSON Responses",e.data)}}))},p=async e=>{console.log(e);let t={org_id:r.A.currentId(),phone_number_id:e.phone_number_id,waba_id:e.waba_id};try{await n.A.doPost({path:"/orgs/".concat(r.A.currentId(),"/whatsapp/es-completion"),data:t})}catch(e){console.error("Error sending code to backend:",e)}},u=function(){let[e,t]=(0,i.useState)(null),[s,p]=(0,i.useState)("init"),u=(0,o.useRouter)();(0,i.useEffect)(()=>{d(),h(),g()},[]);let f=e=>{if(console.log(e),e.authResponse&&e.authResponse.code){let t={code:e.authResponse.code};p("loading"),n.A.doPost({path:"/orgs/".concat(r.A.currentId(),"/whatsapp/es-code"),data:t}).then(()=>{p("loaded"),g()}).catch(e=>{console.log(e),p("error")})}},m=()=>{FB.login(f,{config_id:"1106116187559513",response_type:"code",override_default_response_type:!0,extras:{setup:{},featureType:"",sessionInfoVersion:"2"}})},g=async()=>{if("loading"!==s){p("loading");try{let e=await n.A.doGet({path:"/orgs/".concat(r.A.currentId(),"/whatsapp/connections")});t(e.data),p("loaded")}catch(e){console.log(e),404===e.response.status?(t({connections:[]}),p("loaded")):p("error")}}},x=async()=>{if("loading"!==s){p("loading");try{await n.A.doPost({path:"/orgs/".concat(r.A.currentId(),"/whatsapp/connections")})}catch(e){p("error");return}g()}},b=()=>{"loading"!==s&&m()},y=async()=>{if("loading"!==s){p("loading");try{await n.A.doDelete({path:"/orgs/".concat(r.A.currentId(),"/whatsapp/connections")}),p("loaded"),g()}catch(e){p("error");return}}},w=[],N=[];if("loading"===s)w.push((0,a.jsx)("div",{className:"mt-4",children:"Loading.."}));else if("error"===s)w.push((0,a.jsx)("div",{className:"mt-4",children:"Error while fetching data from server"}));else if("loaded"===s&&e){for(let t of e.connections)for(let e of t.wabas)for(let t of e.phones)N.push({name:t.verified_name,number:t.display_phone_number,quality:t.quality_rating,registered:"CLOUD_API"===t.platform_type?"Yes":"No"});0===N.length?w.push((0,a.jsx)("div",{className:"overflow-x-auto flex-grow mt-8",children:(0,a.jsx)("div",{})})):w.push((0,a.jsx)("div",{className:"overflow-x-auto flex-grow mt-8",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left",children:"Name"}),(0,a.jsx)("th",{className:"text-left",children:"Number"}),(0,a.jsx)("th",{className:"text-left",children:"Quality"}),(0,a.jsx)("th",{className:"text-left",children:"Registered"})]})}),(0,a.jsx)("tbody",{children:N.map(e=>(0,a.jsxs)("tr",{className:"",children:[(0,a.jsx)("td",{className:"py-2",children:e.name}),(0,a.jsx)("td",{className:"py-2",children:e.number}),(0,a.jsx)("td",{className:"py-2",children:e.quality}),(0,a.jsx)("td",{className:"py-2",children:e.registered})]},e.number))})]})}))}return(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-6 text-gray-700",children:[(0,a.jsx)("button",{className:"text-4xl hover:text-gray-800 mb-4 cursor-pointer",onClick:()=>u.push("/settings/?tab=channels-management"),children:(0,a.jsx)(l.eh5,{})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("div",{id:"fb-root"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"text-lg font-bold mb-8",children:"WhatsApp Account"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)(c.$,{variant:"primary",onClick:()=>b(),children:"Add or Update WhatsApp Number"}),(0,a.jsx)(c.$,{variant:"primary",onClick:()=>x(),children:"Troubleshoot"}),(0,a.jsx)(c.$,{variant:"primary",onClick:()=>y(),children:"Disconnect WhatsApp"})]}),...w]})]})]})})}},65e3:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/integration/whatsapp",function(){return s(31146)}])},69241:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=function(){for(var e,t,s=0,a="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=function e(t){var s,a,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var r=t.length;for(s=0;s<r;s++)t[s]&&(a=e(t[s]))&&(n&&(n+=" "),n+=a)}else for(a in t)t[a]&&(n&&(n+=" "),n+=a)}return n}(e))&&(a&&(a+=" "),a+=t);return a}},95313:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(95551).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[5711,4e3,636,6593,8792],()=>t(65e3)),_N_E=e.O()}]);